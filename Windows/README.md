NGHDL Installer (Windows OS)
====


It contains all the documenation for making NGHDL executable (using PyInstaller) and packging for eSim Installation Script on Windows 7 and above.


## NGHDL Executable:

1. Download and install "Python-3.5.2", "Git For Windows". Use "Git Bash" for all following shell commands.
		
		Reference - https://gitforwindows.org/

2. Add alias to python.exe in Git shell:

		$ alias python='winpty python.exe'	#Need to be done for each new shell created

3. Download `virtualenv` package as:

	    $ pip install virtualenv

4. Create a virtual environment as:

		$ python -m virtualenv nghdl

5. Activate the virtual environment as:
	
		$ source nghdl/Scripts/activate

6. Install all Python dependencies for NGHDL within the virtual environment as:
		
		- Install PyInstaller, tornado, SetupTools through pip :

			$ pip install pyinstaller
			$ pip install --upgrade 'setuptools<45.0.0'
		
		- Install PyQt4 through pip (Reference - https://stackoverflow.com/questions/22640640/how-to-install-pyqt4-on-windows-using-pip) :
			
			$ pip install --upgrade 'sip<5.0.0'
			$ pip install <wheel_package_of_PyQt4>
			
			Download PyQt4 Wheel from - [https://www.lfd.uci.edu/~gohlke/pythonlibs/#pyqt4]
			Where cp37 represents the Python version i.e. 3.7.x and so on

			> Note : 
				- If there are any issues regarding loading of DLL files, refer : https://stackoverflow.com/questions/2738879/cannot-import-pyqt4-qtgui
				- If above step works, then goto step 7.

7. Test whether only NGHDL dependencies are available or not:

		$ pip freeze

> Note : Following dependencies should be available -
>	- PyQt4
>	- sip
>	- altgraph
>	- future
>	- pefile
>	- pyinstaller
>	- pywin32-ctypes


8. Create spec file as:

		$ pyi-makespec --onefile -n nghdl <path_to_nghdl>/src/ngspice_ghdl.py

9. Create onefile executable using pyinstaller as:
		
		$ pyinstaller -F --clean nghdl.spec

10. Verify whether all NGHDL `src` files (`*.py`) have been included in `Analysis-00.toc` file under the build folder generated by PyInstaller.
11. nghdl.exe is generated at the dist folder.



## How to package NGHDL with eSim ?

1. Place the nghdl.exe generated from the above process at the location /nghdl/src/

2. Delete all python files (files ending in .py) at /nghdl/src/

3. Remove the following files at /nghdl/
    - .gitignore
    - GHDLside.md
    - Workflow.md

4. Place **nghdl** folder containing `src folder`, `Example folder` & `LICENSE` under folder named eSim/

5. Final directory structure should be: 
- eSim/nghdl/Example
- eSim/nghdl/src 
- eSim/nghdl/LICENSE 

6. Compress the `eSim` folder from step 4 in 7z format (Make sure that there is folder named `eSim` inside this compressed file) and name it as `nghdl-src.7z`.\
(7z compression tool can be downloaded from - https://www.7-zip.org/download.html )

7. ALong with `nghdl-src.7z` from step 5, place the following 7z files at the installer folder for eSim.
(these can be obtained under *sources/* folder in the repository )
- ghdl.7z
- MSYS.7z
- ngspice-nghdl.7z
- mingw64.7z

8.  Place the script `installnghdl.nsi` at the eSim installer location.

9. Follow the rest of the instructions for packging eSim [https://github.com/FOSSEE/eSim/tree/installers/Windows] and compile the NSI script (`esim-setup-script.nsi` file). Now only use the generated installer for distribution.
